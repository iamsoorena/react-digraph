{"version":3,"sources":["../../src/components/graph-view.js"],"names":["d3","styleToString","style","Object","keys","map","k","key","replace","toLowerCase","join","makeStyles","primary","light","dark","background","styles","wrapper","base","height","margin","display","boxShadow","opacity","transition","focused","svg","alignContent","flex","node","color","stroke","fill","filter","strokeWidth","cursor","selected","shape","text","edge","markerEnd","arrow","baseString","selectedString","getTheta","pt1","pt2","xComp","x","yComp","y","theta","Math","atan2","getMidpoint","getDistance","sqrt","pow","GraphView","props","hideEdge","edgeDOMNode","select","attr","showEdge","canSwap","sourceNode","hoveredNode","swapEdge","source","nodeKey","target","lineFunction","data","line","d","drawEdge","swapErrBack","self","dragEdge","entities","append","state","event","on","dragged","ended","remove","edgeSwapQueue","shift","setState","drawingEdge","canCreateEdge","canDeleteEdge","onSwapEdge","renderView","onCreateEdge","dragNode","el","parentElement","classed","oldSibling","readOnly","selectedNode","nextSibling","appendChild","dx","dy","render","datum","insertBefore","onUpdateNode","dispatchEvent","Event","handleNodeDrag","subject","handleDelete","canDeleteNode","onDeleteNode","onSelectNode","onDeleteEdge","handleWrapperKeydown","i","handleSvgClicked","isPartOfEdge","selectingNode","shiftKey","xycoords","mouse","onCreateNode","element","viewWrapper","classList","contains","handleNodeMouseDown","defaultPrevented","preventDefault","stopPropagation","document","activeElement","focus","previousSelection","handleNodeMouseUp","handleNodeMouseEnter","handleNodeMouseLeave","fromMouseup","which","arrowClicked","tagName","getViewNode","dist","nodeSize","edgeArrowSize","handleEdgeDrag","bind","handleEdgeMouseDown","push","onSelectEdge","containZoom","handleZoom","viewTransform","transform","handleZoomToFit","parent","viewBBox","getBBox","width","clientWidth","clientHeight","translate","next","max","minZoom","maxZoom","setZoom","zoomDur","modifyZoom","modK","modX","modY","dur","target_zoom","center","extent","zoom","scaleExtent","translate0","l","t","zoomIdentity","scale","duration","call","getPathDescriptionStr","sourceX","sourceY","targetX","targetY","getPathDescription","src","trg","off","xOff","cos","yOff","sin","console","warn","getEdgeHandleTransformation","origin","PI","offset","edgeHandleSize","getLabelTransformation","rotated","getNodeTransformation","getNodeStyle","getEdgeStyle","renderEdgeLabels","domNode","trans","d3Node","title","label_from","label_to","selectAll","getTextStyle","renderNodeText","titleText","length","maxTitleChars","substring","lineOffset","textOffset","type","emptyType","typeText","nodeTypes","renderEdges","edges","exit","newEdges","enter","drag","transitionTime","merge","updateEdge","els","edgeTimeouts","clearTimeout","setTimeout","renderEdge","each","renderNodes","nodes","overlap","nodeKeyWarned","nodesSelection","undefined","removedNodes","newNodes","updateNode","nodeTimeouts","renderNode","newState","isInSelected","sd","size","isInNewNodes","nd","isInRemovedNodes","rd","view","viewNode","selectionChanged","enableFocus","process","env","NODE_ENV","zoomDelay","nextProps","selectionType","prevProps","prevState","renderDefs","renderBackground","graphControls","Component","propTypes","PropTypes","string","isRequired","array","object","nodeSubtypes","edgeTypes","func","bool","number","gridSize","gridSpacing","gridDot","defaultProps","graphView","index","elements","hasChildNodes","labelTrans","shapeId","selection","subtype","defIndex","graphConfigDefs","forEach","React","cloneElement"],"mappings":"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","file":"graph-view.js","sourcesContent":["// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/*\n  GraphView is a Generic D3 Graph view with no application specific\n  code in it and no significant state except UI state (zoom, for example).\n*/\n\nimport React, {\n  Component\n} from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport Radium from 'radium';\nimport GraphControls from './graph-controls.js'\n\n\nfunction styleToString(style){\n  return Object.keys(style)\n    .map(function(k) {\n      let key = k.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n      return `${key}:${style[k]}`;\n    }).join(\";\")\n}\n\n\nfunction makeStyles(primary='dodgerblue', light='white', dark='black', background='#F9F9F9'){\n let styles = {\n    wrapper: {\n      base: {\n        height: '100%',\n        margin: 0,\n        display: 'flex',\n        boxShadow: 'none',\n        opacity: 1,\n        background: background,\n        transition: \"opacity 0.167s\"\n      },\n      focused: {\n        opacity: 1\n      }\n    },\n    svg: {\n      base: {\n        alignContent: 'stretch',\n        flex: 1\n      }\n    },\n    node: {\n      base: {\n        color: primary,\n        stroke: light,\n        fill: light,\n        filter: 'url(#dropshadow)',\n        strokeWidth: '0.5px',\n        cursor: 'pointer'\n      },\n      selected: {\n        color: light,\n        stroke: primary,\n        fill: primary\n      }\n    },\n    shape: {\n      fill: 'inherit',\n      stroke: dark,\n      strokeWidth: '0.5px'\n    },\n    text: {\n      base:{\n        fill: light,\n        stroke: 'none'\n      },\n      selected: {\n        fill: light,\n        stroke: light\n      }\n    },\n    edge: {\n      base: {\n        color: light,\n        stroke: '#1F4577',\n        strokeWidth: '2px',\n        markerEnd: 'url(#end-arrow)',\n        cursor: 'pointer'\n      },\n      selected: {\n        color: primary,\n        stroke: primary\n      }\n    },\n    arrow: {\n      fill: primary\n    }\n  }\n\n  // Styles need to be strings for D3 to apply them all at once\n  styles.node.baseString = styleToString(styles.node.base);\n  styles.node.selectedString = styleToString({...styles.node.base, ...styles.node.selected});\n  styles.text.baseString= styleToString(styles.text.base);\n  styles.text.selectedString = styleToString({...styles.text.base, ...styles.text.selected});\n  styles.edge.baseString = styleToString(styles.edge.base);\n  styles.edge.selectedString = styleToString({...styles.edge.base, ...styles.edge.selected});\n\n  return styles\n}\n\n// any objects with x & y properties\nfunction getTheta(pt1, pt2) {\n  const xComp = pt2.x - pt1.x;\n  const yComp = pt2.y - pt1.y;\n  const theta = Math.atan2(yComp, xComp);\n  return theta\n}\n\nfunction getMidpoint(pt1, pt2) {\n  const x = (pt2.x + pt1.x)/2;\n  const y = (pt2.y + pt1.y)/2;\n\n  return {x: x, y: y};\n}\n\nfunction getDistance(pt1, pt2) {\n  return  Math.sqrt(Math.pow(pt2.x - pt1.x, 2) + Math.pow(pt2.y - pt1.y, 2))\n}\n\n\n\nclass GraphView extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      viewTransform: d3.zoomIdentity,\n      selectionChanged: false,\n      focused: true,\n      enableFocus: props.enableFocus || false, // Enables focus/unfocus\n      edgeSwapQueue: [],    // Stores nodes to be swapped\n      styles: makeStyles(props.primary, props.light, props.dark, props.background)\n    };\n\n    this.zoom = d3.zoom()\n                  .scaleExtent([props.minZoom, props.maxZoom])\n                  .on(\"zoom\", this.handleZoom);\n\n    this.nodeTimeouts = {};\n    this.edgeTimeouts = {};\n  }\n\n  componentDidMount() {\n    // Window event listeners for keypresses\n    // and to control blur/focus of graph\n    d3.select(this.viewWrapper)\n      .on('keydown', this.handleWrapperKeydown);\n\n    var svg = d3.select(this.viewWrapper)\n      .on(\"touchstart\", this.containZoom)\n      .on(\"touchmove\", this.containZoom)\n      .on(\"click\", this.handleSvgClicked)\n      .select(\"svg\")\n      .call(this.zoom);\n\n    // On the initial load, the 'view' <g> doesn't exist\n    // until componentDidMount. Manually render the first view.\n    this.renderView();\n\n    // It seems Electron/JSDom's mocking of the SVG API is incomplete\n    // and causes D3 to error out when zooming to fit in tests.\n    if(process.env.NODE_ENV !== \"test\"){\n      setTimeout(() => {\n        if (this.viewWrapper != null) {\n          this.handleZoomToFit();\n        }\n      }, this.props.zoomDelay);\n    }\n  }\n\n  componentWillUnmount() {\n    // Remove window event listeners\n    d3.select(this.viewWrapper)\n      .on('keydown', null);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let selectionChanged = false;\n    let selected = this.props.selected;\n    const newState = {};\n\n    if (nextProps.selected !== selected) {\n      newState.selected = nextProps.selected;\n      newState.previousSelection = selected;\n      newState.selectionChanged = true;\n\n      let selectionType = null;\n      if (nextProps.selected && nextProps.selected.source){\n        newState.selectionType = 'edge'\n      } else if (nextProps.selected && nextProps.selected[this.props.nodeKey]) {\n        newState.selectionType = 'node'\n      }\n\n      this.setState(newState);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.selectionChanged) {\n      this.setState({\n        selectionChanged: false\n      });\n    }\n  }\n\n  /*\n   * Handlers/Interaction\n   */\n\n  hideEdge = (edgeDOMNode) => {\n    d3.select(edgeDOMNode)\n      .attr(\"opacity\", 0)\n  }\n\n  showEdge = (edgeDOMNode) => {\n    d3.select(edgeDOMNode)\n      .attr(\"opacity\", 1)\n  }\n\n  canSwap = (sourceNode, hoveredNode, swapEdge) => {\n    return swapEdge.source != sourceNode[this.props.nodeKey] ||\n          swapEdge.target != hoveredNode[this.props.nodeKey]\n  }\n\n  lineFunction = (data) => {\n    // Provides API for curved lines using .curve()\n    // Example: https://bl.ocks.org/d3indepth/64be9fc39a92ef074034e9a8fb29dcce\n    return (d3.line()\n      .x(function (d) {\n        return d.x;\n      })\n      .y(function (d) {\n        return d.y;\n      }))(data);\n  }\n\n  drawEdge = (sourceNode, target, swapErrBack) => {\n    const self = this;\n\n    const dragEdge = d3.select(this.entities).append('svg:path')\n\n    dragEdge.attr('class', 'link dragline')\n      .attr(\"style\", this.state.styles.edge.selectedString)\n      .attr('d', this.lineFunction([\n        { x: sourceNode.x, y: sourceNode.y },\n        { x: d3.event.x, y: d3.event.y }\n      ]));\n\n    d3.event.on(\"drag\", dragged).on(\"end\", ended);\n\n    function dragged(d) {\n      dragEdge.attr( 'd', self.lineFunction([\n        { x: sourceNode.x, y: sourceNode.y },\n        { x: d3.event.x, y: d3.event.y }\n      ]) )\n    }\n\n    function ended(d) {\n      dragEdge.remove();\n\n      let swapEdge = self.state.edgeSwapQueue.shift();\n      let hoveredNode = self.state.hoveredNode;\n\n      self.setState({\n        edgeSwapQueue: self.state.edgeSwapQueue,\n        drawingEdge: false\n      });\n\n      if(hoveredNode && self.props.canCreateEdge(sourceNode, hoveredNode)){\n\n        if( swapEdge ){\n          if(self.props.canDeleteEdge(swapEdge) && self.canSwap(sourceNode,hoveredNode,swapEdge)){\n            self.props.onSwapEdge(sourceNode, hoveredNode, swapEdge)\n            self.renderView()\n          } else {\n            swapErrBack()\n          }\n        } else {\n          self.props.onCreateEdge(sourceNode, hoveredNode)\n          self.renderView()\n        }\n      } else {\n        if (swapErrBack){\n          swapErrBack()\n        }\n      }\n    }\n  }\n\n  dragNode = () => {\n    const self = this;\n\n    const el = d3.select(d3.event.target.parentElement); // Enclosing 'g' element\n    el.classed(\"dragging\", true);\n    d3.event.on(\"drag\", dragged).on(\"end\", ended);\n\n    let oldSibling = null;\n    function dragged(d) {\n      if (self.props.readOnly) return;\n      const selectedNode = d3.select(this);\n      if (!oldSibling) {\n        oldSibling = this.nextSibling;\n      }\n      // Moves child to the end of the element stack to re-arrange the z-index\n      this.parentElement.appendChild(this);\n\n      selectedNode.attr('transform', function(d) {\n        d.x += d3.event.dx;\n        d.y += d3.event.dy;\n        return 'translate(' + d.x + ',' + d.y + ')';\n      });\n      self.render();\n    }\n\n    function ended() {\n      el.classed(\"dragging\", false);\n\n      if(!self.props.readOnly){\n        var d = d3.select(this).datum();\n        // Move the node back to the original z-index\n        if (oldSibling) {\n          oldSibling.parentElement.insertBefore(this, oldSibling);\n        }\n        self.props.onUpdateNode(d);\n      }\n\n      // For some reason, mouseup isn't firing\n      // - manually firing it here\n      d3.select(this).node().dispatchEvent(new Event(\"mouseup\"))\n    }\n  }\n\n  // Node 'drag' handler\n  handleNodeDrag = () => {\n    if(this.state.drawingEdge && !this.props.readOnly){\n      const target = {x: d3.event.subject.x, y: d3.event.subject.y }\n      this.drawEdge(d3.event.subject, target )\n    } else {\n      this.dragNode()\n    }\n  }\n\n  handleDelete = () => {\n    if (this.props.readOnly) return;\n    if (this.props.selected) {\n      const selected = this.props.selected;\n      if (!selected.source && this.props.canDeleteNode(selected)) {\n        this.props.onDeleteNode(selected);\n        this.props.onSelectNode(null);\n      } else if (selected.source && this.props.canDeleteEdge(selected)) {\n        this.props.onDeleteEdge(selected);\n        this.props.onSelectNode(null);\n      }\n    }\n  }\n\n  handleWrapperKeydown = (d, i) => {\n    // Conditionally ignore keypress events on the window\n    // if the Graph isn't focused\n    switch (d3.event.key) {\n      case \"Delete\":\n        this.handleDelete();\n        break;\n      case \"Backspace\":\n        this.handleDelete();\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleSvgClicked = (d, i) => {\n    if (this.isPartOfEdge(d3.event.target)) return; // If any part of the edge is clicked, return\n\n    if (this.state.selectingNode) {\n      this.setState({\n        selectingNode: false\n      });\n    } else {\n      this.props.onSelectNode(null);\n\n      if (!this.props.readOnly && d3.event.shiftKey) {\n          var xycoords = d3.mouse(d3.event.target);\n          this.props.onCreateNode(xycoords[0], xycoords[1]);\n          this.renderView();\n        }\n    }\n  }\n\n  isPartOfEdge = (element) => {\n    while (element != null && element != this.viewWrapper) {\n      if (element.classList.contains(\"edge\")) {\n        return true;\n      }\n      element = element.parentElement;\n    }\n    return false;\n  }\n\n  handleNodeMouseDown = (d) => {\n    if (d3.event.defaultPrevented) {\n      return; // dragged\n    }\n\n    // Prevent d3's default as it changes the focus to the body\n    d3.event.preventDefault();\n    d3.event.stopPropagation();\n    if (document.activeElement != this.viewWrapper) {\n      this.viewWrapper.focus();\n    }\n\n    if (d3.event.shiftKey) {\n\n      this.setState({\n        selectingNode: true,\n        drawingEdge: true\n      })\n\n    } else {\n      const previousSelection = this.state.previousSelection;\n      this.setState({\n        selectingNode: true,\n        selectedNode: d,\n        previousSelection\n      });\n    }\n  }\n\n  handleNodeMouseUp = (d) => {\n    if (this.state.selectingNode) {\n      this.props.onSelectNode(d);\n      this.setState({\n        selectingNode: false\n      });\n    }\n  }\n\n  handleNodeMouseEnter = (d) => {\n    if (this.state.hoveredNode != d){\n      this.setState({\n        hoveredNode: d\n      })\n    }\n  }\n\n  handleNodeMouseLeave = (d) => {\n\n    // For whatever reason, mouseLeave is fired when edge dragging ends\n    // (and mouseup is not fired). This clears the hoverNode state prematurely\n    // resulting in swapEdge failing to fire.\n    // Detecting & ignoring mouseLeave events that result from drag ending here\n    const fromMouseup = d3.event.which == 1;\n    if (this.state.hoveredNode === d && !fromMouseup){\n      this.setState({\n        hoveredNode: null\n      })\n    }\n  }\n\n  // One can't attach handlers to 'markers' or obtain them from the event.target\n  // If the click occurs within a certain radius of edge target,\n  // assume the click occurred on the arrow\n  arrowClicked = (d)=> {\n\n    if(d3.event.target.tagName != 'path') return false; // If the handle is clicked\n\n    const xycoords = d3.mouse(d3.event.target);\n    const target = this.props.getViewNode(d.target);\n    const dist = getDistance({x: xycoords[0], y: xycoords[1]}, target);\n\n    return dist < this.props.nodeSize/2 + this.props.edgeArrowSize + 10 // or *2 or ^2?\n  }\n\n  handleEdgeDrag = (d) => {\n    if(!this.props.readOnly && this.state.drawingEdge ){\n      const edgeDOMNode = d3.event.target.parentElement;\n      const sourceNode = this.props.getViewNode(d.source);\n      const xycoords = d3.mouse(d3.event.target)\n      const target = {x: xycoords[0], y: xycoords[1]}\n\n      this.hideEdge(edgeDOMNode);\n      this.drawEdge(sourceNode, target, this.showEdge.bind(this, edgeDOMNode))\n    }\n  }\n\n\n  handleEdgeMouseDown = (d) => {\n    // Prevent d3's default as it changes the focus to the body\n    d3.event.preventDefault();\n    d3.event.stopPropagation();\n    if (document.activeElement != this.viewWrapper) {\n      this.viewWrapper.focus();\n    }\n\n    if (!this.props.readOnly && this.arrowClicked(d)) {\n      this.state.edgeSwapQueue.push(d)  // Set this edge aside for redrawing\n      this.setState({\n        drawingEdge: true,\n        edgeSwapQueue: this.state.edgeSwapQueue\n      })\n    } else{\n      this.props.onSelectEdge(d);\n    }\n  }\n\n  // Keeps 'zoom' contained\n  containZoom = () => {\n    d3.event.preventDefault();\n  }\n\n  // View 'zoom' handler\n  handleZoom = () => {\n    if (this.state.focused) {\n      this.setState({\n        viewTransform: d3.event.transform\n      });\n    }\n  }\n\n  // Zooms to contents of this.refs.entities\n  handleZoomToFit = () => {\n    const parent = d3.select(this.viewWrapper).node();\n    const entities = d3.select(this.entities).node();\n\n    const viewBBox = entities.getBBox();\n\n    const width = parent.clientWidth;\n    const height = parent.clientHeight;\n\n    let dx,\n        dy,\n        x,\n        y,\n        translate = [this.state.viewTransform.x, this.state.viewTransform.y],\n      next = { x: translate[0], y: translate[1], k: this.state.viewTransform.k };\n\n    if (viewBBox.width > 0 && viewBBox.height > 0){\n      // There are entities\n      dx = viewBBox.width,\n      dy = viewBBox.height,\n      x = viewBBox.x + viewBBox.width / 2,\n      y = viewBBox.y + viewBBox.height / 2;\n\n      next.k = .9 / Math.max(dx / width, dy / height);\n\n      if (next.k < this.props.minZoom){\n        next.k = this.props.minZoom;\n      } else if (next.k > this.props.maxZoom){\n        next.k = this.props.maxZoom;\n      }\n\n      next.x = width / 2 - next.k * x;\n      next.y = height / 2 - next.k * y;\n    }\n    else{\n      next.k = (this.props.minZoom + this.props.maxZoom) / 2;\n      next.x = 0;\n      next.y = 0;\n    }\n\n    this.setZoom(next.k, next.x, next.y, this.props.zoomDur);\n  }\n\n  // Updates current viewTransform with some delta\n  modifyZoom = (modK = 0, modX = 0, modY = 0, dur = 0) => {\n    const parent = d3.select(this.viewWrapper).node();\n    const width = parent.clientWidth;\n    const height = parent.clientHeight;\n\n    let target_zoom,\n        center = [width/2, height/2],\n        extent = this.zoom.scaleExtent(),\n        translate = [this.state.viewTransform.x, this.state.viewTransform.y],\n        translate0 = [],\n        l = [],\n        next = {x: translate[0], y: translate[1], k:  this.state.viewTransform.k};\n\n    target_zoom = next.k * (1 + modK);\n\n    if (target_zoom < extent[0] || target_zoom > extent[1]) { return false; }\n\n    translate0 = [(center[0] - next.x) / next.k, (center[1] - next.y) / next.k];\n    next.k = target_zoom;\n    l = [translate0[0] * next.k + next.x, translate0[1] * next.k + next.y];\n\n    next.x += center[0] - l[0] + modX;\n    next.y += center[1] - l[1] + modY;\n\n    this.setZoom(next.k, next.x, next.y, dur)\n  }\n\n  // Programmatically resets zoom\n  setZoom = (k=1, x=0, y=0, dur=0) => {\n    var t = d3.zoomIdentity.translate(x, y).scale(k);\n    d3.select(this.viewWrapper).select('svg')\n      .transition()\n      .duration(dur)\n      .call(this.zoom.transform, t);\n  }\n\n  /*\n   * Render\n   */\n\n  // Returns the svg's path.d' (geometry description) string from edge data\n  // edge.source and edge.target are node ids\n  // @deprecated - not removed due to potential third party integrations\n  getPathDescriptionStr = (sourceX, sourceY, targetX, targetY) => {\n    return `M${sourceX},${sourceY}L${targetX},${targetY}`\n  }\n\n  getPathDescription = (edge) => {\n    let src = this.props.getViewNode(edge.source);\n    let trg = this.props.getViewNode(edge.target);\n\n    if (src && trg) {\n      const off = this.props.nodeSize / 2; // from the center of the node to the perimeter\n\n      const theta = getTheta(src, trg);\n\n      const xOff = off * Math.cos(theta);\n      const yOff = off * Math.sin(theta);\n\n      return this.lineFunction([\n        { x: src.x + xOff, y: src.y + yOff },\n        { x: trg.x - xOff, y: trg.y - yOff }\n      ]);\n    }\n    console.warn(\"Unable to get source or target for \", edge);\n    return \"\"\n  }\n\n  getEdgeHandleTransformation = (edge) => {\n    let src = this.props.getViewNode(edge.source);\n    let trg = this.props.getViewNode(edge.target);\n\n    let origin = getMidpoint(src, trg);\n    let x = origin.x;\n    let y = origin.y;\n    let theta = getTheta(src, trg)*180/Math.PI;\n    let offset = -this.props.edgeHandleSize/2;\n\n    return `translate(${x}, ${y}) rotate(${theta}) translate(${offset}, ${offset})`\n  }\n\n  getLabelTransformation = (edge) => {\n    let src = this.props.getViewNode(edge.source);\n    let trg = this.props.getViewNode(edge.target);\n    let rotated = false\n\n    let origin = getMidpoint(src, trg);\n    let x = origin.x;\n    let y = origin.y;\n    let theta = getTheta(src, trg)*180/Math.PI;\n    if(theta > 90 || theta < -90){\n      theta = theta + 180\n      rotated = true\n    }\n\n    return [`translate(${x}, ${y}) rotate(${theta}) translate(0,-5)`, rotated]\n  }\n\n  // Returns a d3 transformation string from node data\n  getNodeTransformation = (node) => {\n    return 'translate(' + node.x + ',' + node.y + ')';\n  }\n\n  getNodeStyle = (d, selected) => {\n    return d === selected ?\n      this.state.styles.node.selectedString :\n      this.state.styles.node.baseString\n  }\n\n  getEdgeStyle = (d, selected) => {\n    return d === selected ?\n      this.state.styles.edge.selectedString :\n      this.state.styles.edge.baseString\n  }\n\n  // Renders 'node.title' into node element\n  renderEdgeLabels = (d, domNode, trans) => {\n    let d3Node = d3.select(domNode);\n    let title = ' '\n    if (d.label_from && d.label_to) {\n      title = trans[1] ? `${d.label_to} ↔ ${d.label_from}` : `${d.label_from} ↔ ${d.label_to}`\n    }\n\n    d3Node.selectAll('text').remove()\n\n    let el = d3Node.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('style',  `font-size: 11px; stroke: none`)\n      // .attr('dy', textOffset)\n      .attr(\"transform\", trans[0]);\n\n\n    if (title) {\n      // User defined/secondary text\n      el.append('tspan').text(title).attr('x', 0)\n      el.append('title').text(title);\n    }\n  }\n\n  getTextStyle = (d, selected) => {\n    return d === selected ?\n      this.state.styles.text.selectedString :\n      this.state.styles.text.baseString\n  }\n\n  // Renders 'node.title' into node element\n  renderNodeText = (d, domNode) => {\n    let d3Node = d3.select(domNode);\n    let title = d.title ? d.title : ' ';\n\n    let titleText = title.length <= this.props.maxTitleChars ? title :\n      `${title.substring(0, this.props.maxTitleChars)}...`;\n\n    let lineOffset = 5;\n    let textOffset = d.type === this.props.emptyType ? 18 : 18;\n\n    d3Node.selectAll(\"text\").remove();\n\n    let typeText = this.props.nodeTypes[d.type].typeText;\n    let style = this.getTextStyle(d, this.props.selected);\n\n    let el = d3Node.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('style', style)\n      .attr('dy', textOffset);\n\n    el.append('tspan')\n      .attr('opacity', 0.5)\n      .text(typeText);\n\n    if (title) {\n      // User defined/secondary text\n      el.append('tspan').text(titleText).attr('x', 0).attr('dy', lineOffset)\n\n      el.append('title').text(title);\n    }\n  }\n\n  // Renders 'edges' into entities element\n  renderEdges = (entities, edges) => {\n    var self = this;\n\n    // Join Data\n    var edges = entities.selectAll(\"g.edge\")\n      .data(edges, function(d) {\n        // IMPORTANT: this snippet allows D3 to detect updated vs. new data\n        return `${d.source}:${d.target}`;\n      });\n\n    // Remove Old\n    edges.exit()\n        .remove();\n\n    // Add New\n    var newEdges = edges.enter().append(\"g\").classed(\"edge\", true);\n\n    newEdges\n      .on(\"mousedown\", this.handleEdgeMouseDown)\n      .call(d3.drag().on(\"start\", this.handleEdgeDrag));\n\n    newEdges.attr(\"opacity\", 0)\n      .transition()\n      .duration(self.props.transitionTime)\n      .attr(\"opacity\", 1);\n\n    // Merge\n    edges.enter().merge(edges);\n\n    function updateEdge(d, i, els) {\n      // setTimeout is used to unblock the browser\n      // clearing the previous render's timeout prevents the browser from being overworked\n      const key = `edgeKey-${d.source}_${d.target}`;\n      if (self.edgeTimeouts[key]) {\n        clearTimeout(self.edgeTimeouts[key]);\n      }\n      self.edgeTimeouts[key] = setTimeout(() => {\n        self.props.renderEdge(self, this, d, i, els)\n      });\n    }\n\n    // Update All\n    edges.each(updateEdge);\n  }\n\n  // Renders 'nodes' into entities element\n  renderNodes = (entities, nodes) => {\n    var self = this;\n    const nodeKey = this.props.nodeKey;\n    const parent = this.viewWrapper;\n    const viewTransform = this.state.viewTransform;\n    const overlap = (300 / viewTransform.k);\n\n    // Join Data\n    let nodeKeyWarned = false;\n    var nodesSelection = entities.selectAll(\"g.node\").data(nodes, function(d) {\n      // IMPORTANT: this snippet allows D3 to detect updated vs. new data\n      if (d[nodeKey] === undefined && !nodeKeyWarned) {\n        console.warn(\n          `Warning: The specified nodeKey '${nodeKey}' cannot be found on a node. \\\n          Make sure the nodeKey is accurate and that all nodes contain a property called '${nodeKey}'. \\\n          Performance will degrade when there are nodes with an undefined nodeKey or with duplicate keys.`\n        );\n        nodeKeyWarned = true;\n      }\n      return d[nodeKey]\n    });\n\n    // Animate/Remove Old\n    var removedNodes = nodesSelection.exit()\n      .transition()\n      .duration(self.props.transitionTime)\n      .attr(\"opacity\", 0)\n      .remove();\n\n    // Add New\n    var newNodes = nodesSelection.enter().append(\"g\").classed(\"node\", true);\n\n    newNodes.on(\"mousedown\", this.handleNodeMouseDown)\n      .on(\"mouseup\", this.handleNodeMouseUp)\n      .on(\"click\", (d) => {\n        // Force blocking propagation on node click.\n        // It was found that large graphs would handle clicks on the canvas even\n        // though the mouseDown event blocked propagation.\n        d3.event.stopPropagation();\n        d3.event.preventDefault();\n      })\n      .on(\"mouseenter\", this.handleNodeMouseEnter)\n      .on(\"mouseleave\", this.handleNodeMouseLeave)\n      .call(d3.drag().on(\"start\", this.handleNodeDrag));\n\n    newNodes\n      .attr(\"opacity\", 0)\n      .transition()\n      .duration(self.props.transitionTime)\n      .attr(\"opacity\", 1);\n\n    // Merge\n    nodesSelection.enter().merge(nodesSelection);\n\n    function updateNode(d, i, els) {\n      const key = `nodeKey-${d[nodeKey]}`;\n      // setTimeout is used to unblock the browser\n      // clearing the previous render's timeout prevents the browser from being overworked\n      if (self.nodeTimeouts[key]) {\n        clearTimeout(self.nodeTimeouts[key]);\n      }\n      self.nodeTimeouts[key] = setTimeout(() => {\n        self.props.renderNode(self, this, d, i, els)\n      });\n    }\n\n    // Update Selected and Unselected\n    // New or Removed\n    const selected = nodesSelection.filter((d) => {\n      return (d === this.props.selected ||\n        d === this.state.previousSelection);\n    });\n\n    /*\n      The commented code below would prevent nodes from rendering\n      until they are within the viewport. The problem is that this causes a zoom-to-fit\n      regression. The benefit from the code is that even a gigantic graph is very responsive at first,\n      however as a person zooms out or moves the graph around it would add more nodes.\n      After many nodes are added to the graph the zoom behavior will degrade, and there's no way to\n      remove the existing nodes from the DOM which are outside of the viewport. This degraded performance already\n      exists in the zoom-to-fit scenario for large graphs, since all nodes are rendered and never removed.\n      TODO: figure out if it's possible/worthwhile to remove nodes from the graph that are outside of the viewport\n      TODO: figure out the zoom-to-fit if this is added\n    */\n    // function viewableFilter(d) {\n      // const xPosition = (d.x + viewTransform.x) * viewTransform.k;\n      // const yPosition = (d.y + viewTransform.y) * viewTransform.k;\n      // return xPosition < parent.offsetWidth + overlap &&\n      //   xPosition > 0 - overlap &&\n      //   yPosition < parent.offsetHeight + overlap &&\n      //   yPosition > 0 - overlap;\n    // }\n    // selected.filter(viewableFilter).each(updateNode);\n    // removedNodes.filter(viewableFilter).each(updateNode);\n    // newNodes.filter(viewableFilter).each(updateNode);\n\n    selected.each(updateNode);\n    removedNodes.each(updateNode);\n    newNodes.each(updateNode);\n\n    const newState = {};\n\n    // Update all others\n    // Normally we would want to only render all others on a zoom change,\n    // however sometimes other nodes must be updated on a selection\n    nodesSelection.filter((d) => {\n      const isInSelected = selected.filter((sd) => {\n        return sd === d;\n      }).size();\n      const isInNewNodes = newNodes.filter((nd) => {\n        return nd === d;\n      }).size();\n      const isInRemovedNodes = removedNodes.filter((rd) => {\n        return rd === d;\n      }).size();\n\n      return (\n        // viewableFilter(d) && // see comment above\n        !isInSelected &&\n        !isInNewNodes &&\n        !isInRemovedNodes\n      );\n    }).each(updateNode);\n\n  }\n\n  // Renders 'graph' into view element\n  // All DOM updates within 'view' are managed by D3\n  renderView = () => {\n    var nodes = this.props.nodes;\n    var edges = this.props.edges;\n    // Update the view w/ new zoom/pan\n    const view = d3.select(this.view);\n    const viewNode = view.node();\n    if (viewNode) {\n      const { k, x, y } = this.state.viewTransform;\n      view.attr(\"transform\", this.state.viewTransform);\n      // viewNode.setAttribute('transform', `translate(${x},${y}) scale(${k})`);\n      viewNode.style.transform = null;\n    }\n\n    const entities = d3.select(this.entities);\n\n    this.renderNodes(entities, nodes);\n    this.renderEdges(entities, edges);\n  }\n\n\n  render() {\n    this.renderView();\n    const { styles, focused } = this.state;\n    return (\n      <div\n          className='viewWrapper'\n          tabIndex={0}\n          onFocus={() => {\n            this.setState({\n              focused: true\n            });\n          }}\n          onBlur={() => {\n            if (this.props.enableFocus) {\n              this.setState({\n                focused: false\n              });\n            }\n          }}\n          ref={(el) => this.viewWrapper = el}\n          style={[\n            styles.wrapper.base,\n            !!focused && styles.wrapper.focused,\n            this.props.style\n          ]}>\n        <svg style={styles.svg.base}>\n          { this.props.renderDefs(this) }\n          <g className='view' ref={(el) => this.view = el}>\n            { this.props.renderBackground(this) }\n            <g className='entities' ref={(el) => this.entities = el}></g>\n          </g>\n        </svg>\n        {this.props.graphControls && (\n        <GraphControls  primary={this.props.primary}\n                        minZoom={this.props.minZoom}\n                        maxZoom={this.props.maxZoom}\n                        zoomLevel={this.state.viewTransform.k}\n                        zoomToFit={this.handleZoomToFit}\n                        modifyZoom={this.modifyZoom}>\n        </GraphControls>\n        )}\n      </div>\n    );\n\n\n  }\n\n}\n\nGraphView.propTypes = {\n  nodeKey: PropTypes.string.isRequired,\n  emptyType: PropTypes.string.isRequired,\n  nodes: PropTypes.array.isRequired,\n  edges: PropTypes.array.isRequired,\n  selected: PropTypes.object.isRequired,\n  nodeTypes: PropTypes.object.isRequired,\n  nodeSubtypes: PropTypes.object.isRequired,\n  edgeTypes: PropTypes.object.isRequired,\n  getViewNode: PropTypes.func.isRequired,\n  onSelectNode: PropTypes.func.isRequired,\n  onCreateNode: PropTypes.func.isRequired,\n  onUpdateNode: PropTypes.func.isRequired,\n  onDeleteNode: PropTypes.func.isRequired,\n  onSelectEdge: PropTypes.func.isRequired,\n  onCreateEdge: PropTypes.func.isRequired,\n  onSwapEdge: PropTypes.func.isRequired,\n  onDeleteEdge: PropTypes.func.isRequired,\n  canDeleteNode: PropTypes.func,\n  canCreateEdge: PropTypes.func,\n  canDeleteEdge: PropTypes.func,\n  renderEdge: PropTypes.func,\n  renderNode: PropTypes.func,\n  renderDefs: PropTypes.func,\n  renderBackground: PropTypes.func,\n  readOnly: PropTypes.bool,\n  enableFocus: PropTypes.bool,\n  maxTitleChars: PropTypes.number, // Per line.\n  transitionTime: PropTypes.number, // D3 Enter/Exit duration\n  primary: PropTypes.string,\n  light: PropTypes.string,\n  dark: PropTypes.string,\n  background: PropTypes.string,\n  style: PropTypes.object,\n  gridSize: PropTypes.number, // The point grid is fixed\n  gridSpacing: PropTypes.number,\n  gridDot: PropTypes.number,\n  minZoom: PropTypes.number,\n  maxZoom: PropTypes.number,\n  nodeSize: PropTypes.number,\n  edgeHandleSize: PropTypes.number,\n  edgeArrowSize: PropTypes.number,\n  zoomDelay: PropTypes.number, // ms\n  zoomDur: PropTypes.number, // ms\n  graphControls: PropTypes.bool,\n};\n\nGraphView.defaultProps = {\n  readOnly: false,\n  maxTitleChars: 9,\n  transitionTime: 150,\n  primary: 'dodgerblue',\n  light: '#FFF',\n  dark: '#000',\n  background: '#F9F9F9',\n  gridSize: 40960, // The point grid is fixed\n  gridSpacing: 36,\n  gridDot: 2,\n  minZoom: 0.15,\n  maxZoom: 1.5,\n  nodeSize: 150,\n  edgeHandleSize: 50,\n  edgeArrowSize: 8,\n  zoomDelay: 500,\n  zoomDur: 750,\n  graphControls: true,\n  renderEdge: (graphView, domNode, datum, index, elements ) => {\n\n    // For new edges, add necessary child domNodes\n    if (!domNode.hasChildNodes()){\n      d3.select(domNode).append(\"path\");\n      d3.select(domNode).append(\"use\");\n    }\n\n    let style = graphView.getEdgeStyle(datum, graphView.props.selected);\n    let trans = graphView.getEdgeHandleTransformation(datum)\n    let labelTrans = graphView.getLabelTransformation(datum)\n\n    d3.select(domNode)\n      .attr(\"style\", style)\n      .select(\"use\")\n        .attr(\"xlink:href\", function(d){ return graphView.props.edgeTypes[d.type].shapeId })\n        .attr(\"width\", graphView.props.edgeHandleSize)\n        .attr(\"height\", graphView.props.edgeHandleSize)\n        .attr(\"transform\", trans);\n\n    d3.select(domNode)\n      .select('path')\n        .attr('d', graphView.getPathDescription);\n    graphView.renderEdgeLabels(datum, domNode, labelTrans);\n  },\n  renderNode: (graphView, domNode, datum, index, elements) => {\n    // For new nodes, add necessary child domNodes\n    const selection = d3.select(domNode);\n    if (!domNode.hasChildNodes()) {\n      selection.append(\"use\").classed(\"subtypeShape\", true)\n        .attr(\"x\", -graphView.props.nodeSize/2)\n        .attr(\"y\",  -graphView.props.nodeSize/2)\n        .attr(\"width\", graphView.props.nodeSize)\n        .attr(\"height\", graphView.props.nodeSize);\n      selection.append(\"use\").classed(\"shape\", true)\n        .attr(\"x\", -graphView.props.nodeSize/2)\n        .attr(\"y\",  -graphView.props.nodeSize/2)\n        .attr(\"width\", graphView.props.nodeSize)\n        .attr(\"height\", graphView.props.nodeSize);\n    }\n\n    let style = graphView.getNodeStyle(datum, graphView.props.selected);\n\n    selection\n      .attr(\"style\", style);\n\n    if (datum.subtype) {\n      selection.select(\"use.subtypeShape\")\n        .attr(\"xlink:href\", function (d) { return graphView.props.nodeSubtypes[d.subtype].shapeId });\n    } else {\n      selection.select(\"use.subtypeShape\")\n        .attr(\"xlink:href\", function (d) { return null });\n    }\n\n    selection.select(\"use.shape\")\n      .attr(\"xlink:href\", function (d) { return graphView.props.nodeTypes[d.type].shapeId });\n\n    selection.attr('id', `node-${datum[graphView.props.nodeKey]}`);\n\n    graphView.renderNodeText(datum, domNode);\n\n    selection.attr('transform', graphView.getNodeTransformation);\n  },\n  renderDefs: (graphView) => {\n    const { styles } = graphView.state;\n    const {\n      edgeArrowSize,\n      gridSpacing,\n      gridDot,\n      nodeTypes,\n      nodeSubtypes,\n      edgeTypes\n    } = graphView.props;\n\n    let defIndex = 0;\n    let graphConfigDefs = [];\n\n    Object.keys(nodeTypes).forEach(function(type){\n      defIndex += 1;\n      graphConfigDefs.push(React.cloneElement(nodeTypes[type].shape, {key: defIndex}))\n    })\n\n    Object.keys(nodeSubtypes).forEach(function(type){\n      defIndex += 1;\n      graphConfigDefs.push(React.cloneElement(nodeSubtypes[type].shape, {key: defIndex}))\n    })\n\n    Object.keys(edgeTypes).forEach(function(type){\n      defIndex += 1;\n      graphConfigDefs.push(React.cloneElement(edgeTypes[type].shape, {key: defIndex}))\n    })\n\n    return (\n      <defs>\n        {graphConfigDefs}\n\n        <marker id=\"end-arrow\"\n                key=\"end-arrow\"\n                viewBox={`0 -${edgeArrowSize/2} ${edgeArrowSize} ${edgeArrowSize}`}\n                refX={`${edgeArrowSize/2}`}\n                markerWidth={`${edgeArrowSize}`}\n                markerHeight={`${edgeArrowSize}`}\n                orient=\"auto\">\n          <path style={ styles.arrow }\n                d={`M0,-${edgeArrowSize/2}L${edgeArrowSize},0L0,${edgeArrowSize/2}`}>\n          </path>\n        </marker>\n\n        <pattern  id=\"grid\"\n                  key=\"grid\"\n                  width={gridSpacing}\n                  height={gridSpacing}\n                  patternUnits=\"userSpaceOnUse\">\n          <circle cx={gridSpacing/2}\n                  cy={gridSpacing/2}\n                  r={gridDot}\n                  fill=\"lightgray\">\n          </circle>\n        </pattern>\n\n        <filter id=\"dropshadow\" key=\"dropshadow\" height=\"130%\">\n          <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"3\"/>\n          <feOffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>\n          <feComponentTransfer>\n            <feFuncA type=\"linear\" slope=\"0.1\"/>\n          </feComponentTransfer>\n          <feMerge>\n            <feMergeNode/>\n            <feMergeNode in=\"SourceGraphic\"/>\n          </feMerge>\n        </filter>\n\n      </defs>\n    )\n  },\n  renderBackground: (graphView) => {\n    return (\n      <rect className='background'\n        x={-graphView.props.gridSize/4}\n        y={-graphView.props.gridSize/4}\n        width={ graphView.props.gridSize }\n        height={ graphView.props.gridSize }\n        fill=\"url(#grid)\">\n      </rect>\n    )\n  },\n  canDeleteNode: () => true,\n  canCreateEdge: () => true,\n  canDeleteEdge: () => true,\n};\n\nexport default Radium(GraphView)\n"]}